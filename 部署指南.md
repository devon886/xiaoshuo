# ðŸš€ å°è¯´ç½‘ç«™å®Œæ•´éƒ¨ç½²æŒ‡å—

## ðŸ“‹ éƒ¨ç½²æ¦‚è§ˆ

æ‚¨çš„é¡¹ç›®æ˜¯ä¸€ä¸ªå…¨æ ˆå°è¯´ç½‘ç«™ï¼ŒåŒ…å«ï¼š
- **åŽç«¯**: Node.js + Express + Socket.io API
- **å‰ç«¯**: Vue.js + TypeScript + Element Plus 
- **æ•°æ®åº“**: MongoDB
- **ç‰¹è‰²åŠŸèƒ½**: å®žæ—¶åä½œç¼–è¾‘ã€ç”¨æˆ·è®¤è¯ã€å°è¯´ç®¡ç†

## ðŸŽ¯ éƒ¨ç½²æ–¹å¼é€‰æ‹©

### æ–¹æ¡ˆ1: ä¼ ç»Ÿäº‘æœåŠ¡å™¨éƒ¨ç½² (æŽ¨è)
é€‚åˆï¼šä¸­å°åž‹é¡¹ç›®ï¼Œéœ€è¦å®Œå…¨æŽ§åˆ¶
å¹³å°ï¼šé˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€åŽä¸ºäº‘ã€AWSç­‰

### æ–¹æ¡ˆ2: å®¹å™¨åŒ–éƒ¨ç½² (Docker)
é€‚åˆï¼šå›¢é˜Ÿå¼€å‘ï¼Œæ˜“äºŽæ‰©å±•
å¹³å°ï¼šä»»ä½•æ”¯æŒDockerçš„çŽ¯å¢ƒ

### æ–¹æ¡ˆ3: Serverlesséƒ¨ç½²
é€‚åˆï¼šæµé‡ä¸ç¨³å®šçš„é¡¹ç›®
å¹³å°ï¼šVercelã€Netlifyç­‰

---

## ðŸŒŸ æ–¹æ¡ˆ1: äº‘æœåŠ¡å™¨éƒ¨ç½² (è¯¦ç»†æ•™ç¨‹)

### ç¬¬ä¸€æ­¥: æœåŠ¡å™¨å‡†å¤‡

#### 1.1 è´­ä¹°äº‘æœåŠ¡å™¨
**æŽ¨èé…ç½®**:
- CPU: 2æ ¸å¿ƒä»¥ä¸Š
- å†…å­˜: 4GBä»¥ä¸Š
- å­˜å‚¨: 40GBä»¥ä¸Š
- æ“ä½œç³»ç»Ÿ: Ubuntu 20.04 LTS æˆ– CentOS 8

#### 1.2 è¿žæŽ¥æœåŠ¡å™¨
```bash
# ä½¿ç”¨SSHè¿žæŽ¥
ssh root@your-server-ip
```

#### 1.3 å®‰è£…åŸºç¡€çŽ¯å¢ƒ
```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# å®‰è£…Node.js (æŽ¨èä½¿ç”¨NodeSource)
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# éªŒè¯å®‰è£…
node --version  # åº”è¯¥æ˜¾ç¤º v18.x.x
npm --version

# å®‰è£…PM2 (è¿›ç¨‹ç®¡ç†å™¨)
sudo npm install -g pm2

# å®‰è£…Git
sudo apt install git -y
```

### ç¬¬äºŒæ­¥: MongoDBæ•°æ®åº“é…ç½®

#### 2.1 å®‰è£…MongoDB
```bash
# å¯¼å…¥å…¬é’¥
wget -qO - https://www.mongodb.org/static/pgp/server-6.0.asc | sudo apt-key add -

# æ·»åŠ MongoDBæº
echo "deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu focal/mongodb-org/6.0 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-6.0.list

# å®‰è£…MongoDB
sudo apt-get update
sudo apt-get install -y mongodb-org

# å¯åŠ¨MongoDBæœåŠ¡
sudo systemctl start mongod
sudo systemctl enable mongod

# éªŒè¯å®‰è£…
sudo systemctl status mongod
```

#### 2.2 é…ç½®MongoDBå®‰å…¨æ€§
```bash
# è¿›å…¥MongoDB Shell
mongosh

# åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·
use admin
db.createUser({
  user: "admin",
  pwd: "your-strong-password",
  roles: [{ role: "userAdminAnyDatabase", db: "admin" }]
})

# åˆ›å»ºåº”ç”¨æ•°æ®åº“ç”¨æˆ·
use novel-website
db.createUser({
  user: "novel-user",
  pwd: "your-app-password", 
  roles: [{ role: "readWrite", db: "novel-website" }]
})

exit
```

#### 2.3 å¯ç”¨MongoDBè®¤è¯
```bash
# ç¼–è¾‘é…ç½®æ–‡ä»¶
sudo nano /etc/mongod.conf

# æ·»åŠ ä»¥ä¸‹é…ç½®
security:
  authorization: enabled

# é‡å¯MongoDB
sudo systemctl restart mongod
```

### ç¬¬ä¸‰æ­¥: éƒ¨ç½²åº”ç”¨ä»£ç 

#### 3.1 ä¸Šä¼ ä»£ç 
```bash
# æ–¹æ³•1: ä½¿ç”¨Git (æŽ¨è)
cd /home
git clone https://your-git-repository.git novel-website
cd novel-website

# æ–¹æ³•2: ä½¿ç”¨SCPä¸Šä¼ 
# åœ¨æœ¬åœ°æ‰§è¡Œ:
# scp -r /path/to/your/project root@your-server-ip:/home/novel-website
```

#### 3.2 å®‰è£…ä¾èµ–
```bash
cd /home/novel-website
npm install --production
```

#### 3.3 é…ç½®çŽ¯å¢ƒå˜é‡
```bash
# åˆ›å»ºç”Ÿäº§çŽ¯å¢ƒé…ç½®
nano .env
```

æ·»åŠ ä»¥ä¸‹å†…å®¹:
```env
# åŸºç¡€é…ç½®
NODE_ENV=production
PORT=5000

# æ•°æ®åº“é…ç½®
MONGO_URI=mongodb://novel-user:your-app-password@localhost:27017/novel-website

# JWTå¯†é’¥ (è¯·ç”Ÿæˆä¸€ä¸ªå¼ºå¯†é’¥)
JWT_SECRET=your-super-secure-jwt-secret-key-here

# å…¶ä»–é…ç½®
CORS_ORIGIN=https://your-domain.com
```

### ç¬¬å››æ­¥: å‰ç«¯æž„å»º

#### 4.1 åˆ›å»ºå‰ç«¯æž„å»ºé…ç½®
```bash
# åˆ›å»ºå‰ç«¯package.json
cat > frontend-package.json << 'EOF'
{
  "name": "novel-website-frontend",
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "build": "vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "vue": "^3.3.4",
    "vue-router": "^4.2.4",
    "pinia": "^2.1.6",
    "element-plus": "^2.3.8",
    "axios": "^1.4.0",
    "socket.io-client": "^4.7.2",
    "vue-toastification": "^2.0.0-rc.5"
  },
  "devDependencies": {
    "@vitejs/plugin-vue": "^4.2.3",
    "vite": "^4.4.5",
    "typescript": "^5.0.2"
  }
}
EOF
```

#### 4.2 åˆ›å»ºViteé…ç½®
```bash
cat > vite.config.ts << 'EOF'
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'

export default defineConfig({
  plugins: [vue()],
  build: {
    outDir: 'dist',
    assetsDir: 'assets',
    minify: 'terser',
    rollupOptions: {
      input: {
        main: 'index.html'
      }
    }
  },
  server: {
    proxy: {
      '/api': 'http://localhost:5000'
    }
  }
})
EOF
```

#### 4.3 å®‰è£…å‰ç«¯ä¾èµ–å¹¶æž„å»º
```bash
# ä½¿ç”¨å‰ç«¯package.jsonå®‰è£…ä¾èµ–
cp frontend-package.json package-frontend.json
npm install --prefix . --package-lock-only

# æž„å»ºå‰ç«¯
npx vite build
```

### ç¬¬äº”æ­¥: é…ç½®è¿›ç¨‹ç®¡ç†

#### 5.1 åˆ›å»ºPM2é…ç½®æ–‡ä»¶
```bash
cat > ecosystem.config.js << 'EOF'
module.exports = {
  apps: [{
    name: 'novel-website',
    script: 'server.js',
    instances: 'max',
    exec_mode: 'cluster',
    env: {
      NODE_ENV: 'development'
    },
    env_production: {
      NODE_ENV: 'production',
      PORT: 5000
    },
    log_file: './logs/app.log',
    error_file: './logs/error.log',
    out_file: './logs/out.log',
    max_memory_restart: '500M',
    watch: false,
    ignore_watch: ['node_modules', 'logs']
  }]
}
EOF
```

#### 5.2 åˆ›å»ºæ—¥å¿—ç›®å½•å¹¶å¯åŠ¨åº”ç”¨
```bash
# åˆ›å»ºæ—¥å¿—ç›®å½•
mkdir -p logs

# å¯åŠ¨åº”ç”¨
pm2 start ecosystem.config.js --env production

# ä¿å­˜PM2é…ç½®
pm2 save

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
```

### ç¬¬å…­æ­¥: é…ç½®Nginxåå‘ä»£ç†

#### 6.1 å®‰è£…Nginx
```bash
sudo apt install nginx -y
sudo systemctl start nginx
sudo systemctl enable nginx
```

#### 6.2 é…ç½®Nginx
```bash
sudo nano /etc/nginx/sites-available/novel-website
```

æ·»åŠ ä»¥ä¸‹é…ç½®:
```nginx
server {
    listen 80;
    server_name your-domain.com www.your-domain.com;
    
    # é™æ€æ–‡ä»¶ç¼“å­˜
    location /assets/ {
        root /home/novel-website/dist;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
    
    # APIä»£ç†
    location /api/ {
        proxy_pass http://localhost:5000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
    
    # Socket.ioæ”¯æŒ
    location /socket.io/ {
        proxy_pass http://localhost:5000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    # å‰ç«¯åº”ç”¨
    location / {
        root /home/novel-website/dist;
        try_files $uri $uri/ /index.html;
        add_header X-Frame-Options "SAMEORIGIN";
        add_header X-Content-Type-Options "nosniff";
    }
}
```

#### 6.3 å¯ç”¨ç«™ç‚¹
```bash
# åˆ›å»ºè½¯é“¾æŽ¥
sudo ln -s /etc/nginx/sites-available/novel-website /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯Nginx
sudo systemctl restart nginx
```

### ç¬¬ä¸ƒæ­¥: SSLè¯ä¹¦é…ç½®

#### 7.1 å®‰è£…Certbot
```bash
sudo apt install certbot python3-certbot-nginx -y
```

#### 7.2 èŽ·å–SSLè¯ä¹¦
```bash
# è‡ªåŠ¨é…ç½®SSL
sudo certbot --nginx -d your-domain.com -d www.your-domain.com

# è®¾ç½®è‡ªåŠ¨ç»­æœŸ
sudo systemctl enable certbot.timer
```

### ç¬¬å…«æ­¥: é˜²ç«å¢™é…ç½®

```bash
# é…ç½®UFWé˜²ç«å¢™
sudo ufw allow ssh
sudo ufw allow 'Nginx Full'
sudo ufw enable
```

---

## ðŸ³ æ–¹æ¡ˆ2: Dockerå®¹å™¨åŒ–éƒ¨ç½²

### åˆ›å»ºDockerfile
```dockerfile
# åŽç«¯Dockerfile
FROM node:18-alpine

WORKDIR /app

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY package*.json ./
RUN npm ci --only=production

# å¤åˆ¶åº”ç”¨ä»£ç 
COPY . .

# æž„å»ºå‰ç«¯ (å¦‚æžœéœ€è¦)
RUN npm run build:frontend || true

EXPOSE 5000

CMD ["npm", "start"]
```

### åˆ›å»ºdocker-compose.yml
```yaml
version: '3.8'

services:
  app:
    build: .
    ports:
      - "5000:5000"
    environment:
      - NODE_ENV=production
      - MONGO_URI=mongodb://mongo:27017/novel-website
      - JWT_SECRET=your-jwt-secret
    depends_on:
      - mongo
    volumes:
      - ./logs:/app/logs

  mongo:
    image: mongo:6.0
    ports:
      - "27017:27017"
    environment:
      - MONGO_INITDB_ROOT_USERNAME=admin
      - MONGO_INITDB_ROOT_PASSWORD=password
    volumes:
      - mongo_data:/data/db

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/nginx/ssl
    depends_on:
      - app

volumes:
  mongo_data:
```

### éƒ¨ç½²å‘½ä»¤
```bash
# æž„å»ºå¹¶å¯åŠ¨
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

---

## ðŸ”§ ç”Ÿäº§çŽ¯å¢ƒä¼˜åŒ–

### æ€§èƒ½ä¼˜åŒ–
```bash
# å¯ç”¨gzipåŽ‹ç¼© (åœ¨Nginxé…ç½®ä¸­)
gzip on;
gzip_vary on;
gzip_min_length 1024;
gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

# è®¾ç½®æ–‡ä»¶ä¸Šä¼ é™åˆ¶
client_max_body_size 10M;
```

### ç›‘æŽ§é…ç½®
```bash
# å®‰è£…ç›‘æŽ§å·¥å…·
npm install -g @pm2/web

# å¯åŠ¨ç›‘æŽ§ç•Œé¢
pm2 web
```

### æ—¥å¿—ç®¡ç†
```bash
# é…ç½®æ—¥å¿—è½®è½¬
sudo nano /etc/logrotate.d/novel-website

# æ·»åŠ é…ç½®
/home/novel-website/logs/*.log {
    daily
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 root root
}
```

## ðŸ“ éƒ¨ç½²æ£€æŸ¥æ¸…å•

### éƒ¨ç½²å‰æ£€æŸ¥
- [ ] åŸŸåå·²è§£æžåˆ°æœåŠ¡å™¨IP
- [ ] æœåŠ¡å™¨å®‰å…¨ç»„/é˜²ç«å¢™å·²é…ç½®
- [ ] MongoDBæ•°æ®åº“å·²å®‰è£…å¹¶é…ç½®è®¤è¯
- [ ] çŽ¯å¢ƒå˜é‡å·²æ­£ç¡®è®¾ç½®
- [ ] SSLè¯ä¹¦å·²ç”³è¯·

### éƒ¨ç½²åŽæ£€æŸ¥
- [ ] åº”ç”¨æ­£å¸¸å¯åŠ¨ (`pm2 status`)
- [ ] æ•°æ®åº“è¿žæŽ¥æ­£å¸¸
- [ ] APIæŽ¥å£å¯ä»¥è®¿é—®
- [ ] Socket.ioè¿žæŽ¥æ­£å¸¸
- [ ] å‰ç«¯é¡µé¢åŠ è½½æ­£å¸¸
- [ ] HTTPSé‡å®šå‘å·¥ä½œ
- [ ] æ—¥å¿—è®°å½•æ­£å¸¸

## ðŸ†˜ å¸¸è§é—®é¢˜è§£å†³

### é—®é¢˜1: MongoDBè¿žæŽ¥å¤±è´¥
```bash
# æ£€æŸ¥MongoDBçŠ¶æ€
sudo systemctl status mongod

# æŸ¥çœ‹MongoDBæ—¥å¿—
sudo tail -f /var/log/mongodb/mongod.log

# æ£€æŸ¥è¿žæŽ¥å­—ç¬¦ä¸²æ ¼å¼
mongodb://username:password@host:port/database
```

### é—®é¢˜2: PM2åº”ç”¨å´©æºƒ
```bash
# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
pm2 logs

# é‡å¯åº”ç”¨
pm2 restart novel-website

# æ£€æŸ¥å†…å­˜ä½¿ç”¨
pm2 monit
```

### é—®é¢˜3: Nginx 502é”™è¯¯
```bash
# æ£€æŸ¥åŽç«¯æœåŠ¡çŠ¶æ€
pm2 status

# æ£€æŸ¥Nginxé…ç½®
sudo nginx -t

# æŸ¥çœ‹Nginxé”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log
```

## ðŸš€ å¿«é€Ÿéƒ¨ç½²è„šæœ¬

æˆ‘å¯ä»¥ä¸ºæ‚¨åˆ›å»ºä¸€ä¸ªè‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬ï¼Œä¸€é”®å®Œæˆæ•´ä¸ªéƒ¨ç½²è¿‡ç¨‹ã€‚éœ€è¦å—ï¼Ÿ

---

**éƒ¨ç½²å®ŒæˆåŽï¼Œæ‚¨çš„å°è¯´ç½‘ç«™å°†å…·å¤‡**:
- âœ… é«˜å¯ç”¨æ€§å’Œè´Ÿè½½å‡è¡¡
- âœ… HTTPSå®‰å…¨è¿žæŽ¥
- âœ… è‡ªåŠ¨è¿›ç¨‹ç®¡ç†å’Œé‡å¯
- âœ… æ—¥å¿—ç›‘æŽ§å’Œè½®è½¬
- âœ… æ•°æ®åº“å®‰å…¨è®¤è¯
- âœ… é™æ€èµ„æºä¼˜åŒ–ç¼“å­˜